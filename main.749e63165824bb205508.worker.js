!function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1)}([function(e,t){function a(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=a=function(e){return typeof e}:e.exports=a=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(t)}e.exports=a},function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r);var s=/[12]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])/;function o(e){if("string"==typeof e){if(s.test(e)){var t=e.slice(0,4),a=e.slice(5,7),r=e.slice(8,10);return new Date(t,a-1,r)}throw new Error("String '".concat(e,"' is not a valide date format (YYYY-MM-DD)"))}if(e instanceof Date)return e;throw new Error("Type ".concat(n()(e)," is not handled by Utils.date.stringToDate()"))}function c(e){var t=(new Date).getFullYear(),a=(new Date).getMonth(),r=u(e.filter(e=>e.date.getFullYear()===t)),n=e.filter(e=>e.date.getFullYear()===t&&e.date.getMonth()===a);return r.currentMonth=u(n),r}function i(e,t=30){let a={};var r=new Date,n=new Date(r.getFullYear(),r.getMonth(),r.getDate())-864e5*(t+1),s=new Date(r.getFullYear(),r.getMonth(),r.getDate())-864e5;e.filter(e=>e.date>=n&&e.date<=s).forEach(e=>{e.amount<0&&(e.category||(e.category=0),a[e.category]||(a[e.category]={earliest:0,oldiest:0}),a[e.category].earliest=a[e.category].earliest+e.amount)});var o=new Date(r.getFullYear(),r.getMonth(),r.getDate())-864e5*(2*t+2),c=new Date(r.getFullYear(),r.getMonth(),r.getDate())-864e5*(t+2);e.filter(e=>e.date>=o&&e.date<=c).forEach(e=>{e.amount<0&&(e.category||(e.category=0),a[e.category]||(a[e.category]={earliest:0,oldiest:0}),a[e.category].oldiest=a[e.category].oldiest+e.amount)});let i=[],u=0,g=0,l=0;return Object.keys(a).forEach(e=>{i.push({id:e,diff:a[e].oldiest-a[e].earliest,earliest:a[e].earliest,oldiest:a[e].oldiest}),u+=a[e].oldiest-a[e].earliest,g+=a[e].earliest,l+=a[e].oldiest}),i=i.sort((e,t)=>e.diff<t.diff?1:-1),{diff:u,firstRange:{dateBegin:n,dateEnd:s,sum:g},secondRange:{dateBegin:o,dateEnd:c,sum:l},trend:i}}function u(e=[]){let t=0,a=0,r={},n={};return e.forEach(e=>{e.category&&!r[e.category]&&(r[e.category]={expenses:0,incomes:0,counter:0}),n[e.date.getFullYear()]||(n[e.date.getFullYear()]={expenses:0,incomes:0,counter:0,months:{}}),n[e.date.getFullYear()].months[e.date.getMonth()]||(n[e.date.getFullYear()].months[e.date.getMonth()]={expenses:0,incomes:0,counter:0,days:{}}),n[e.date.getFullYear()].months[e.date.getMonth()].days[e.date.getDate()]||(n[e.date.getFullYear()].months[e.date.getMonth()].days[e.date.getDate()]={expenses:0,incomes:0,counter:0});const s=n[e.date.getFullYear()];s.counter+=1,e.amount>=0?(a+=e.amount,s.incomes+=e.amount,s.months[e.date.getMonth()].incomes+=e.amount,s.months[e.date.getMonth()].counter+=1,s.months[e.date.getMonth()].days[e.date.getDate()].incomes+=e.amount,s.months[e.date.getMonth()].days[e.date.getDate()].counter+=1,e.category&&(r[e.category].incomes+=e.amount)):(t+=e.amount,s.expenses+=e.amount,s.months[e.date.getMonth()].expenses+=e.amount,s.months[e.date.getMonth()].counter+=1,s.months[e.date.getMonth()].days[e.date.getDate()].expenses+=e.amount,s.months[e.date.getMonth()].days[e.date.getDate()].counter+=1,e.category&&(r[e.category].expenses+=e.amount))}),{incomes:a,expenses:t,perDates:n,perCategories:r,perCategoriesArray:Object.keys(r).map(e=>({id:e,incomes:r[e].incomes,expenses:r[e].expenses})).sort((e,t)=>e.expenses>t.expenses?1:-1)}}function g(e){let t={values:[]},a={values:[]};return Object.keys(e.perDates).forEach(r=>{Object.keys(e.perDates[r].months).forEach(n=>{e.perDates[r].months[n]?(t.values.push({date:new Date(r,n),value:-1*+e.perDates[r].months[n].expenses}),a.values.push({date:new Date(r,n),value:e.perDates[r].months[n].incomes})):(t.values.push({date:new Date(r,n),value:0}),a.values.push({date:new Date(r,n),value:0}))})}),[t,a]}onmessage=function(e){var t=e.data;const{uuid:a}=t;var{transactions:r,nomadlist:n,begin:s,end:l,category:d,categoriesToExclude:y}=t,p=[];switch(r||(r=[]),r.forEach(e=>{e.date=o(e.date)}),t.type){case"STATISTICS_DASHBOARD":{const e=u(p=r);postMessage({uuid:a,type:t.type,transactions:p,currentYear:c(r),trend7:i(r,7),trend30:i(r,30),stats:e,graph:g(e)});break}case"STATISTICS_VIEWER":p=r.filter(e=>e.date>=s&&e.date<=l),postMessage({uuid:a,type:t.type,transactions:p,currentYear:c(r),stats:u(p)});break;case"STATISTICS_PER_DATE":p=r.filter(e=>e.date>=s&&e.date<=l),postMessage({uuid:a,type:t.type,transactions:p,stats:u(p)});break;case"STATISTICS_PER_CATEGORY":p=r.filter(e=>e.category===d),postMessage({uuid:a,type:t.type,transactions:p,stats:u(p)});break;case"STATISTICS_SEARCH":p=r.filter(e=>function(e,t){var a=t.toLowerCase();e=e.toLowerCase();for(var r=0,n=0;n<t.length;n++)a[n]===e[r]&&(r+=1);return r===e.length}(t.text||"",e.name)),postMessage({uuid:a,type:t.type,transactions:p,stats:u(p)});break;case"STATISTICS_NOMADLIST":{const e=function(e,t){const a={cities:{},countries:{}},r=new Date;return e.data.trips.forEach(e=>{const n=o(e.date_start),s=o(e.date_end);if(s<=r&&(e.transactions=t.filter(e=>e.date>=n&&e.date<=s),e.transactions.length)){const t=`${e.place}-${e.country_code}`;a.cities[t]||(a.cities[t]={country:e.country,country_code:e.country_code,country_slug:e.country_slug,place:e.place,place_slug:e.place_slug,averageStay:0,averageExpenses:0,averagePerDay:0,averagePerMonth:0,stay:0,transactions_length:0,trips:[]}),a.countries[e.country_code]||(a.countries[e.country_code]={country:e.country,country_code:e.country_code,country_slug:e.country_slug,averageStay:0,averageExpenses:0,averagePerDay:0,averagePerMonth:0,stay:0,transactions_length:0,trips:[]}),e.stats=u(e.transactions),e.stay=Math.ceil(Math.abs(n-s)/864e5),0==e.stay&&(e.stay=1),e.perDay=e.stats.expenses/e.stay,e.perMonth=365.25*e.stats.expenses/e.stay/12,a.cities[t].stay+=e.stay,a.cities[t].transactions_length+=e.transactions.length,a.cities[t].trips.push(e),a.cities[t].averageStay+=e.stay,a.cities[t].averageExpenses+=e.stats.expenses,a.cities[t].averagePerDay+=e.perDay,a.cities[t].averagePerMonth+=e.perMonth,a.countries[e.country_code].stay+=e.stay,a.countries[e.country_code].transactions_length+=e.transactions.length,a.countries[e.country_code].trips.push(e),a.countries[e.country_code].averageStay+=e.stay,a.countries[e.country_code].averageExpenses+=e.stats.expenses,a.countries[e.country_code].averagePerDay+=e.perDay,a.countries[e.country_code].averagePerMonth+=e.perMonth}}),Object.values(a.cities).forEach(e=>{e.averageStay=e.averageStay/e.trips.length,e.averageExpenses=e.averageExpenses/e.trips.length,e.averagePerDay=e.averagePerDay/e.trips.length,e.averagePerMonth=e.averagePerMonth/e.trips.length}),Object.values(a.countries).forEach(e=>{e.averageStay=e.averageStay/e.trips.length,e.averageExpenses=e.averageExpenses/e.trips.length,e.averagePerDay=e.averagePerDay/e.trips.length,e.averagePerMonth=e.averagePerMonth/e.trips.length}),{cities:Object.values(a.cities),countries:Object.values(a.countries)}}(n,p=r.filter(e=>-1==y.indexOf(e.category)));postMessage({uuid:a,type:t.type,cities:e.cities,countries:e.countries});break}default:return}}}]);
//# sourceMappingURL=main.749e63165824bb205508.worker.js.map